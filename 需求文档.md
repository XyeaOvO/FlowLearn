### **软件需求文档：FlowLearn - 自动化生词学习助手**

#### **1. 项目概述**

**1.1. 项目名称:**
FlowLearn - 自动化生词学习助手

**1.2. 项目目标:**
开发一款桌面应用程序，旨在解决语言学习者在数字学习场景中，因查询生词而导致学习流程频繁中断的问题。本应用通过监听剪贴板、批量处理、并与用户选择的AI模型联动，实现一个无缝、高效的“收集-查询-存储-复习”自动化学习闭环。

**1.3. 目标用户:**
在电脑上使用互联网、电子文档、视频等方式进行英语或其他语言学习的自学者。他们目前习惯于使用OCR工具或手动复制来获取生词，并求助于AI来获取解释。

**`【优化建议】` 1.4. 设计哲学:**
*   **无缝集成 (Seamless):** 作为后台辅助工具，应尽可能不打扰用户当前的工作流。
*   **用户可控 (User in Control):** 自动化是核心，但用户必须拥有随时干预的最终控制权（如手动触发、暂停、修改）。
*   - **高度可定制 (Highly Customizable):** 核心参数（如触发条件、Prompt）应开放给用户，以适应不同的学习习惯和AI模型。

---

#### **2. 核心功能需求 (Functional Requirements)**

**2.1. 模块一：后台静默监听与收集 (Clipboard Monitor)**
*   **FR-1.1:** 应用启动后，在后台运行，并持续监听系统剪贴板的文本内容变化。
*   **FR-1.2:** 当剪贴板出现新的文本内容时，自动将其添加到一个临时的“生词篮子”中。
*   **FR-1.3:** **去重处理**：如果新复制的文本（忽略首尾空格和大小写）与“生词篮子”中已有的条目相同，则不予添加。
*   **FR-1.4:** **内容过滤 (基础)**：应忽略空内容、纯数字或过长的文本（例如超过10个单词），以避免误收集。
*   **`【优化建议】` FR-1.5: 高级内容过滤配置:** 在设置中，允许用户自定义过滤规则：
    *   `FR-1.5.1:` 可配置最小/最大单词数。
    *   `FR-1.5.2:` 可选择是否忽略包含换行符的文本。
    *   `FR-1.5.3:` (高级) 支持正则表达式过滤，让用户定义更复杂的匹配规则。
*   **`【优化建议】` FR-1.6: 手动干预:** 提供一个全局快捷键（用户可自定义），当用户复制一段文本后按下该快捷键，可以强制将该文本加入“生词篮子”，绕过所有过滤规则。

**2.2. 模块二：批量触发与Prompt生成 (Batch Trigger & Prompt Generator)**
*   **FR-2.1:** 用户可以在设置中自定义一个“触发阈值”（默认为5）。
*   **FR-2.2:** 当“生词篮子”中的词条数量达到该阈值时，应用应主动触发一个动作。
*   **`【优化建议】` FR-2.2.1: 手动触发:** 无论篮子中词条数量多少，用户都应能通过系统托盘菜单的选项（如“立即处理篮中X个生词”）手动触发该动作。
*   **FR-2.3:** 触发时，通过系统通知提醒用户。通知内容应为：“您已收集{count}个生词，点击复制学习Prompt。”
*   **FR-2.4:** 应用需根据“生词篮子”中的所有词条，**自动生成一个结构化的JSON格式Prompt**。点击通知后，这个生成的Prompt会自动复制到用户的剪贴板。
*   **FR-2.5:** **【关键】Prompt模板**（用户可在设置中自定义）：
    ```
    请将以下{count}个词语或表达的解释，以一个JSON数组的格式返回给我。不要在JSON代码块前后添加任何描述性文字或寒暄。
    这个数组中的每一个对象都必须包含以下四个键（key）：
    - "term": 词语本身 (string)
    - "definition": 简洁的中文释义 (string)
    - "phonetic": 国际音标 (string)
    - "example": 包含中英双语的例句 (string)
    // 【优化建议】可考虑添加一个可选的键，让AI提供上下文分类
    - "domain": 该词汇最常出现的领域（如 "科技", "金融", "日常"）(string, optional)

    请确保你的回答是一个格式正确的、可以直接被程序解析的JSON。

    词汇列表： ["{word1}", "{word2}", ... , "{wordN}"]
    ```*   **FR-2.6:** 生成Prompt后，临时“生词篮子”应被清空，同时应用进入“等待AI结果”的状态。
*   **`【优化建议】` FR-2.7: 等待状态超时:** “等待AI结果”状态应有一个超时机制（例如5分钟）。如果超时后仍未检测到有效的JSON，应通过通知提醒用户（“FlowLearn仍在等待您的学习结果，需要帮助吗？”），并自动恢复到正常的“监听收集”状态，以防应用卡死。

**2.3. 模块三：结果解析与存储 (Result Parser & Storage)**
*   **FR-3.1:** 在“等待AI结果”状态下，应用需特别监听剪贴板中是否出现了符合JSON格式的长文本。
*   **FR-3.2:** 当用户复制了AI返回的JSON响应后，应用应自动检测并尝试解析该JSON文本。
*   **`【优化建议】` FR-3.2.1: 智能提取:** AI有时会在JSON代码块前后添加额外文字。应用应能智能地从剪贴板文本中提取出由 `[` 和 `]` 或 `{` 和 `}` 包裹的主体JSON部分再进行解析。
*   **FR-3.3:** **数据解析与验证**：成功解析后，应用需验证JSON结构是否符合预期（即包含`term`, `definition`, `phonetic`, `example`键的对象数组）。
*   **FR-3.4:** **数据存储**：将解析后的每一个词条对象，连同当前日期、`【优化建议】`**复习状态（默认为新词）**，作为一个独立的记录存入本地的永久生词库（SQLite）。
*   **FR-3.5:** 存储成功后，通过系统通知告知用户：“{count}个学习结果已成功保存！”
*   **FR-3.6:** **错误处理**：
    *   `FR-3.6.1:` 如果复制的文本不是有效的JSON，或者JSON结构不符合要求，应弹窗提示用户具体原因：“无法解析学习结果。原因：非标准JSON格式 / 缺少必要的键（如'term'）。”
    *   `【优化建议】` `FR-3.6.2:` 错误通知中应提供一个“重试”按钮，让应用可以继续停留在“等待AI结果”状态。

**2.4. 模块四：生词库管理与复习 (Vocabulary Bank)**
*   **FR-4.1:** 应用需要提供一个主界面，用于展示所有已存储的生词。
*   **FR-4.2:** **列表展示**：以列表形式展示所有单词（`term`）和添加日期。
*   **FR-4.3:** **详情查看**：点击列表中的任一单词，可以在界面右侧或下方区域显示其完整的详细信息。
*   **FR-4.4:** **搜索与过滤**：
    *   `FR-4.4.1:` 提供一个搜索框，允许用户根据关键词快速查找已保存的单词。
    *   `【优化建议】` `FR-4.4.2:` 提供基于添加日期范围的过滤功能。
    *   `【优化建议】` `FR-4.4.3:` 提供基于复习状态（新词、学习中、已掌握）的过滤功能。
*   **FR-4.5:** **编辑与删除**：用户可以编辑或删除词条。
*   **`【优化建议】` FR-4.6: 间隔重复复习系统 (Spaced Repetition System - SRS):**
    *   `FR-4.6.1:` 每个词条应包含复习状态（新词、学习中、已掌握）和下一次复习日期（`review_due_date`）。
    *   `FR-4.6.2:` 提供一个“复习模式”。在该模式下，应用会像抽认卡一样，一次展示一个到期应复习的单词。
    *   `FR-4.6.3:` 用户看完单词后，可选择“忘记”或“掌握”。系统根据用户的选择，使用简化的艾宾浩斯算法更新该词的复习状态和下一次复习日期（例如，“忘记”则10分钟后复习，“掌握”则根据当前熟练度在1天、3天、7天后复习）。

---

#### **3. 用户界面 (UI) 与用户体验 (UX) 设计**

*   **3.1. 系统托盘图标:**
    *   左键单击：打开/隐藏主界面。
    *   右键单击：弹出菜单，包含：“显示窗口”、“暂停/继续监听”、`【优化建议】`“**立即处理篮中 {count} 个生词**”、`【优化建议】`“**清空生词篮子**”、“设置”、“退出应用”。
    *   `【优化建议】` **图标状态**: 托盘图标上可以有一个小的数字徽章，实时显示“生词篮子”中的数量。

*   **3.2. 主窗口 (生词库界面):**
    *   采用经典的两栏或三栏布局。
    *   左栏为筛选/分类区（如按日期、按复习状态）。
    *   中栏为可滚动的生词列表。
    *   右栏为详情展示区。
    *   `【优化建议】` 窗口顶部设置一个醒目的“**开始今日复习**”按钮。

*   **3.3. 设置窗口:**
    *   允许用户修改“触发阈值”、“Prompt模板”以及 `【优化建议】` “高级内容过滤规则”和“全局快捷键”。

*   **3.4. 通知:**
    *   使用操作系统的原生通知，确保体验统一。
    *   通知应包含可交互按钮（如“复制Prompt”，“重试”）。

*   **`【优化建议】` 3.5. 首次使用引导 (Onboarding):**
    *   应用首次启动时，应有一个简短的、可视化的引导流程，用3-4步向用户演示核心工作流：“1. 复制生词 -> 2. 点击通知复制Prompt -> 3. 粘贴到AI工具 -> 4. 复制AI结果回来即可”。

---

#### **4. 非功能性需求 (Non-Functional Requirements)**

*   **4.1. 平台:** 跨平台桌面应用 (Windows, macOS)。
*   **4.2. 性能:** 作为后台常驻应用，必须保持极低的CPU和内存占用。
*   **4.3. 数据存储:** 所有用户数据均存储在本地。建议使用轻量级数据库如SQLite，并对数据库文件进行加密，保障用户数据隐私。
*   **4.4. 可靠性:** 应用需能稳定长时间运行，并能优雅地处理各种异常情况。
*   **`【优化建议】` 4.5. 隐私与安全:**
    *   明确声明应用本身不进行任何网络通信，所有与AI的交互均由用户通过复制粘贴完成，保证API Key等敏感信息绝不经过本应用。
*   **`【优化建议】` 4.6. 自动更新:** 应用应内置检查更新的功能，可以提示用户或在用户同意后自动更新到最新版本。

---

#### **5. 技术栈建议**

*   **框架:** **Electron.js** 或 **Tauri** (`【优化建议】` Tauri使用Rust后端，性能更好、安装包更小，但开发门槛稍高，可作为备选)。
*   **语言:** **TypeScript**。
*   **前端UI库:** **React** 或 **Vue.js**。
*   **数据库:** **SQLite** (`better-sqlite3` 库)。
*   **剪贴板监控:** Electron内置 `clipboard` 模块。
*   **系统通知:** Electron内置 `Notification` 模块。
*   **`【优化建议】` 状态管理:** Redux Toolkit (React) 或 Pinia (Vue) 来管理应用状态（如生词篮子、等待状态等）。
*   **`【优化建议】` 自动更新:** 使用 `electron-updater` 库。

---

#### **6. 增强后的端到端工作流**

1.  用户启动FlowLearn，系统托盘出现图标，后台开始监听。首次启动会展示一个快速上手引导。
2.  用户在阅读时看到生词 "ubiquitous"，复制它。托盘图标徽章变为 "1"。
3.  用户继续学习，相继复制 "ephemeral", "resilience", "anomaly", "eloquent"。
4.  当 "eloquent" 被复制后，篮子数量达到5。
5.  屏幕右下角弹出通知：“您已收集5个生词，点击复制学习Prompt。”
6.  用户点击通知，一个精心构造的JSON Prompt被复制到剪贴板，应用进入“等待AI结果”状态（有5分钟超时）。
7.  用户切换到任意AI聊天工具，粘贴并发送该Prompt。
8.  AI返回一段包含额外文字和格式化JSON的代码。
9.  用户复制整段响应。
10. FlowLearn检测到复制操作，**智能地从中提取出JSON部分**，成功解析并验证结构。
11. 将5个词条（包含所有信息和默认的“新词”复习状态）存入本地SQLite数据库。
12. 弹出通知：“5个学习结果已成功保存！”应用自动恢复为普通监听模式。
13. 稍后，用户想复习，点击托盘图标，打开主窗口，点击“开始今日复习”，进入抽认卡模式，高效地巩固记忆。